@PART[*]:HAS[@MODULE[ModuleRCSFX],MODULE[B9PartSwitch:HAS[#switcherDescription[RCS?Mode]]]]:NEEDS[B9PartSwitch]:FOR[zzzStockalikeHypergols]
{
	
	IspVacHTP = 160
	IspASLHTP = 120
	@IspVacHTP *= #$IspMult$
	@IspASHTP *= #$IspMult$
  
  	IspVacHyper = 290
	IspASLHyper = 180
	@IspVacHyper *= #$IspMult$
	@IspASHyper *= #$IspMult$
	
	@MODULE[ModuleB9PartSwitch]:HAS[#switcherDescription[RCS?Mode]]
	{
	 	SUBTYPE
		{
			name = HydrogenPeroxide
			title = HydrogenPeroxide
			primaryColor = LightLightBlue
			secondaryColor = LightLightBlue
			descriptionDetail = #HydrogenPeroxide<br><b>Isp:</b> $/IspASLHTP$ / $/IspVacHTP$ s.
			MODULE
			{
				IDENTIFIER
				{
					name = ModuleRCSFX
				}
				DATA
				{
					thrusterPower = #$/MODULE[ModuleRCSFX]/thrusterPower$
					resourceName = HydrogenPeroxide
					PROPELLANT
					{
						name = HydrogenPeroxide
						ratio = 1
						resourceFlowMode = STAGE_PRIORITY_FLOW
					}
					atmosphereCurve
					{
						key = #0 $/IspVac$
						key = #1 $/IspASL$
						key = 4 0.001
					}
				}
			}
		}
   		
		SUBTYPE
		{
			name = Hypergolic
			title = Hypergolic
			primaryColor = PurpleBrown
			secondaryColor = SalmonPink
			descriptionDetail = #Hypergolic<br><b>Isp:</b> $/IspASLHTP$ / $/IspVacHTP$ s.
			MODULE
			{
				IDENTIFIER
				{
					name = ModuleRCSFX
				}
				DATA
				{
					thrusterPower = #$/MODULE[ModuleRCSFX]/thrusterPower$
					PROPELLANT
					{
						name = Aerozine
						ratio = 0.9
						resourceFlowMode = STAGE_PRIORITY_FLOW
					}
         				PROPELLANT
					{
						name = Nitroxide
						ratio = 1.1
						resourceFlowMode = STAGE_PRIORITY_FLOW
					}
					atmosphereCurve
					{
						key = #0 $/IspVacHyper$
						key = #1 $/IspASLHyper$
						key = 4 0.001
					}
				}
			}
		}
	}
}

@PART[*]:HAS[@MODULE[ModuleRCSFX],!MODULE[B9PartSwitch:HAS[#switcherDescription[RCS?Mode]]]]:NEEDS[B9PartSwitch]:FOR[zzzStockalikeHypergols]
{
	IspVac = #$MODULE[ModuleRCSFX]/atmosphereCurve/key,0[1, ]$ // get vac Isp number
	IspASL = #$MODULE[ModuleRCSFX]/atmosphereCurve/key,1[1, ]$ // get ASL Isp number
	IspMult = #$IspVac$ // set numerator for div operation
	@IspMult /= 240 // denominator, the highest vac Isp number among all targeted parts
	
	// precision sequence to keep div number at 2dp and not let it be 12+dp
	@IspMult += 0.005
	@IspMult *= 100
	@IspMult = #$IspMult[0,.]$ // regex truncate, unknown behavior but used in RO
	@IspMult /= 100
  
  	IspVacHTP = 160
	IspASLHTP = 120
	@IspVacHTP *= #$IspMult$
	@IspASHTP *= #$IspMult$
  
  	IspVacHyper = 290
	IspASLHyper = 180
	@IspVacHyper *= #$IspMult$
	@IspASHyper *= #$IspMult$

	@description ^= :$: <br><color="green">RCS can accept other fuels.</color>

	MODULE
	{
		name = ModuleB9PartSwitch
		moduleID = RCS
		switcherDescription = RCS Mode
		switcherDescriptionPlural = RCS Modes
		switchInFlight = True
		SUBTYPE
		{
			name = MonoPropellant
			title = MonoPropellant
			primaryColor = ResourceColorMonoPropellant
			secondaryColor = ResourceColorMonoPropellant
			descriptionDetail = #MonoPropellant<br><b>Isp:</b> $/IspASL$ / $/IspVac$ s.
			MODULE
			{
				IDENTIFIER
				{
					name = ModuleRCSFX
				}
				DATA
				{
					thrusterPower = #$/MODULE[ModuleRCSFX]/thrusterPower$
					resourceName = MonoPropellant
					PROPELLANT
					{
						name = MonoPropellant
						ratio = 1
						resourceFlowMode = STAGE_PRIORITY_FLOW
					}
					atmosphereCurve
					{
						key = #0 $/IspVac$
						key = #1 $/IspASL$
						key = 4 0.001
					}
				}
			}
	   }
	   	 	SUBTYPE
		{
			name = HydrogenPeroxide
			title = HydrogenPeroxide
			primaryColor = LightLightBlue
			secondaryColor = LightLightBlue
			descriptionDetail = #HydrogenPeroxide<br><b>Isp:</b> $/IspASLHTP$ / $/IspVacHTP$ s.
			MODULE
			{
				IDENTIFIER
				{
					name = ModuleRCSFX
				}
				DATA
				{
					thrusterPower = #$/MODULE[ModuleRCSFX]/thrusterPower$
					resourceName = HydrogenPeroxide
					PROPELLANT
					{
						name = HydrogenPeroxide
						ratio = 1
						resourceFlowMode = STAGE_PRIORITY_FLOW
					}
					atmosphereCurve
					{
						key = #0 $/IspVac$
						key = #1 $/IspASL$
						key = 4 0.001
					}
				}
			}
	  }
   		 SUBTYPE
		{
			name = Hypergolic
			title = Hypergolic
			primaryColor = PurpleBrown
			secondaryColor = SalmonPink
			descriptionDetail = #HydrogenPeroxide<br><b>Isp:</b> $/IspASLHTP$ / $/IspVacHTP$ s.
			MODULE
			{
				IDENTIFIER
				{
					name = ModuleRCSFX
				}
				DATA
				{
					thrusterPower = #$/MODULE[ModuleRCSFX]/thrusterPower$
					PROPELLANT
					{
						name = Aerozine
						ratio = 0.9
						resourceFlowMode = STAGE_PRIORITY_FLOW
					}
         				PROPELLANT
					{
						name = Nitroxide
						ratio = 1.1
						resourceFlowMode = STAGE_PRIORITY_FLOW
					}
					atmosphereCurve
					{
						key = #0 $/IspVacHyper$
						key = #1 $/IspASLHyper$
						key = 4 0.001
					}
				}
			}
   
		}
	}
}
